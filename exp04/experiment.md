## 實驗步驟及程式
本實驗以利用PWM來輸出電壓訊號，經H全橋驅動電路推動致動器為最終目的。其中需逐步量測訊號處理中間過程的訊號，以確認學員在未來遇到相同電路設計時，具有能力於部份電路元件故障時能夠找出故障源更換並修複電路。

---
### 1. 觀察PWM輸出頻率及波寬實驗

本實驗由PWM 卡產生，指定頻率指定波寬之重覆波形，以示波器觀測所生波形。   

- 硬體配線及設定：
  - 以接麵包板擴充排線將M128微控制器板40PIN接到麵包板。
  - 在麵包板上實作出LM386功率放大驅動喇叭電路。
  - 以單心線將麵包板擴充排線腳座的腳接到示波器。(可執行PWM1,PWM2，觀察三相PWM1 C通道, 單相PWM2 )
  - 找一支空接腳，設定為輸出，以備於PWM中斷時輸出觸發訊號，將這支腳接到示波器另一通道，並設定示波器以此通道為同步觸發。

- 程式撰寫：
  - 以Printf()，Scanf() 函式，經人機介面，詢問PWM的設定選擇。
    包括：PWM1或2選擇，基本時脈選擇，正負脈波選擇，如為PWM1則有，總時脈數設定，波寬設定。
  - 依設定選擇，參考課程提供之PWM標準使用SOP步驟撰寫程式，輸出不同設定條件下的波形。
  - 在中斷中，增加M128_DIO_fpt()輸出觸發同步脈波。

- 實測產生並觀察記錄波形特徵：
  - 以示波器觀察 PWM 1-C, PWM2產生波形，觀察頻率，以及波寬，記錄其變化與設定參數之關係。
  - 建立表格，對於每項可選擇參至少進行兩種不同選擇，並觀察波形上的變化。
    - 基本時脈選擇，及PWM週期總脈波數，共同決定頻率(週期格數)
    - 正負脈波，波寬設定：共同決定，HI/LO各佔週期寬度比例。

- 本段實驗報告數據
  - 提供示波器上圖形照片，看圖說故事，對照設定值及波形，檢討是否吻合。
  - 上述實驗觀察表格。

### 2. 觀察PWM波寬變化實驗

本實驗由PWM 卡產生，固定PWM頻率，連續變化波寬之PWM波形，以示波器觀測所生波形。   

- 硬體配線及設定：
  同上一實驗

- 程式撰寫：同上一個實驗，唯
  1. 增加每多少中斷執行一次波寬調整cycle，
  2. 輸出波寬設定，依據sin(θ)產生。θ=i×2 π/ 100  其中  i=0→99

- 實測產生並觀察記錄波形特徵：
  -以示波器觀察 PWM 1-C, PWM2產生波形，觀察波寬變化，以及同波寬次數。

- 本段實驗報告數據
  - 選擇至少兩種具有代表性不同cycle 下的PWM波形照片。

### 3. 以PWM替代DAC執行播音實驗

本單元在設定PWM工作模式之後，以允許讀取的模式開啟ASA_SDC記憶卡，中ADC實驗錄好的聲音檔案。之後進入輪詢迴路，迴路中會查看PWM中斷是否己執行過波寬調整，如果己執行過就再由ASA+SDC記憶卡讀取新波寬，以備下次中斷輸出之用。  

- 電路配縣：
  - 以接麵包板擴充排線將M128微控制器板40PIN接到麵包板。
  - 在麵包板上實作出LM386功率放大驅動喇叭電路。
  - 以單心線將麵包板擴充排線腳座的腳接到LM386功率放大驅動喇叭電路。
  - ASA_SDC配線連接ASA_M128單板電腦。

- 程式寫作
  - 主程式撰寫
    - 呼叫ASA_SDC_set()允讀開啟前ADC單元所錄音聲音檔案。
    - 以40KHz為PWM頻率，以4K為波寬調整頻率。
    - 參考前述決定並設定PWM工作條件，呼叫ASA_PWM_set() ,ASA_PWM_put(),及ASA_PWM_isr()完成，PWM工作方式設定。
    - 呼叫ASA_SDC_get() 讀取並計算出第一筆波寬資料，存入廣域波寬暫存變數。並設定有無新波寬變數為有。
    - while( ASA_SDC檔案未結束)
      - IF ( 有無新波寬變數 ==無)
        - 呼叫ASA_SDC_get()
          - 若ASA_SDC_get() RETURN 為OK
            - 讀取並計算下筆波寬資料，存入廣域波寬暫存變數。並設定有無新波寬變數為有。
          - 若ASA_SDC_get() RETURN 不OK，ASA_SDC檔案結束。

  - PWM中斷服務函式撰寫
    - 以入廣域波寬暫存變數呼叫ASA_PWM_put() 調整PWM波寬。
    - 重設有無新波寬變數為無。


- 實測產生並觀察記錄波形特徵： 以示波器分別依據前後級觀察
  - PWM 1-C, PWM2產生波形：
  - 輸入LM386訊號：探針應探測分壓電阻輸出點接RC濾波之前，注意：不能在LM386輸入端。
  - 輸出LM386訊號：探針置於LM385輸出接腳。
  - 突波吸收電路輸出訊號：探針置於輸出交聯電容端。
  - 每一次，以兩通道量測相隣前後級兩個訊號，以做比較。

- 本段實驗報告數據
  - 提供示波器上圖形照片，看圖說故事，對照每一級電路輸入與輸出訊號波形，比較處理前處理後波形之特徵變化，並討論那一級電路有何作用。

### 4. PWM與全橋電橋電路驅動線圈負載播音實驗
本單元以PWM經全橋電路驅動喇叭線圈達到播音的效果。

- 電路配線
  -以接麵包板擴充排線將M128微控制器板40PIN接到麵包板。
  -在麵包板上參考前面圖12的全橋電路圖接出全橋驅動電路，其中電源使用5V電源，且圖中電晶體改用MOSFET電晶體對，線圈負載以喇叭來擔任，另串接一個0.5歐姆功率電阻以備量測電流。
  -以單心線將麵包板擴充排線腳座的腳接PWM輸入，腳接到ON/OFF輸入。

- 程式撰寫：
  使用與上一個實驗『以PWM替代DAC執行播音實驗』相同的程式。

- 實測產生並觀察記錄波形特徵：
  -負載垮壓量測：將喇叭以4歐姆功率電阻代替，示波器量取跨4歐姆電壓波形。
  -負載電流量測：以原喇叭負載串聯0.5歐姆功率電阻取代原喇叭負載，以示波器量測跨0.5歐姆功率電阻電壓，(即流過喇叭電流)。

- 本段實驗報告數據
  -提供示波器上圖形照片，對照跨喇叭驅動電壓及電流，看圖說故事，說明兩者波形的不同，以及可能的原因。
