## 實驗步驟/程式
- - -


本單元將實際演練，如何用文字人機，來設定單板電腦內**狀態空間方程式**的`A,B,C,D`，及初始狀態`x[0]`。之後以文字人機送入輸入數列`u`，執行狀態空間方程式疊代更新，側錄輸出數列`y`。最後以文字人機讀回側錄之輸出數列。

### ASA單板程式流程說明
本實驗在ASA單板電腦上，建構單輸入單輸出，2自由度之狀態空間模型。程式於開始時，接受文字人機通訊設定狀態參數，初始狀態，以及輸入控制數列。之後，以控制數列逐次疊代更新產生並側錄輸出值。
程式流程簡述如下



1. 宣告，定義並初始為0以下參數及變數
    - 包含型態為浮點數之以及等狀態空間參數`A,B,C,D`及`x`初值的結構。
    - 型態為浮點數之控制輸入數列u
    - 型態為浮點數之感測輸出數列y
2. 以printf()提示通知人機，即將由ASA單板送出，狀態空間參數及初值資料結構內容。再以scanf()等待取得文字人機確認。
3. 收到文字人機確認後，呼叫HMIForm_put()將狀態空間參數及初值的資料結構內容送往文字人機。
4. 以printf()提示通知人機，請操作人員修改狀態空間參數及初值的資料結構內容後回傳。再以scanf()等待文字人機確認己修改完成並將回傳。
5. 收到文字人機確認後，呼叫HMIForm_get()讀取己修改後之狀態空間參數及初值的資料結構內容。
6. 以printf()及scanf()提示及確認,並以HMI_get()，分每32BYTES一包，請操作人員100筆資料分多包輸入控制數列。
7. 逐筆取用`u`輸入控制，以狀態空間方程式，執行100次疊代更新狀態空間及輸出，並將每次疊代結果之輸出存入`y`感測輸出數列中。
8. 分多包，每包32BYTES，以printf()及scanf()提示及確認,並以HMI_put()，每批傳送輸出結果數列`y`。

### 一、文字人機應用軟體測試
應用上一小節所撰寫的ASA單板電腦程式，使用文字人機執行狀態空間參數設定，以及動態模擬並回傳結果。
本實驗以狀態空間

$$
A = \begin{matrix} 1.35 & 0.55 \\ -0.45 & 0.35 \end{matrix}
 B = \begin{matrix} 0.5  \\ 0.5 \end{matrix}
 C = \begin{matrix} 3  & 1 \end{matrix}
 D = 1
$$

先以步階輸入$$ u = \begin{matrix} 0 & 1 & ... & 1 \end{matrix} $$，$$ x [0] = \begin{matrix} 0 \\ 0 \end{matrix}$$模擬步階響應。

1. 完成ASA單板電腦與PC之連線，以及前一步驟程式之燒錄。
2. 開啟電腦，
3. 點選執行文字人機應用軟體。
4. 完成PC端COM PORT通訊設定後，按ASA單板電腦重置開始執行。
5. 依ASA以printf()送來對話框中的訊息逐步完成
參數之設定
輸入數列之傳送，同時存檔。
模擬之進行
模擬結果之接收及存檔。
6. 於MATLAB程式中，
讀進存檔之輸入數列。
讀進模擬結果數列
繪出圖步階輸入及步階響應圖。

實驗報告中應附本段實驗步驟結果，
文字人機，各步驟對話截圖畫。
MATLAB所繪之步階輸入及步階響應圖。


### 二、Matlab文字人機測試
應用上第一小節所撰寫的ASA單板電腦程式，使用MATLAB文字人機執行狀態空間參數設定，以及動態模擬並回傳結果。
本實驗以狀態空間

$$
A = \begin{matrix} 0 & 1 \\ -2 & 2 \end{matrix}
 B = \begin{matrix} 0  \\ 1 \end{matrix}
 C = \begin{matrix} -2  & 4 \end{matrix}
 D = 1
$$

初始狀態設為 $$ x [0] = \begin{matrix} 0 \\ 0 \end{matrix}$$ 模擬弦波響應。

1. 完成ASA單板電腦與PC之連線，以及前一步驟程式之燒錄。
2. 開啟電腦，
3. 點選執行MATLAB應用軟體。
4. 以MATLAB產生輸入弦波100點，每個弦波至少3到4點以上。
5. 完成MATLAB端COM PORT通訊設定後，按ASA單板電腦重置開始執行。
6. MATLAB以scanf()監看ASA以printf()送來對話訊息逐步完成
參數之設定
輸入弦波數列之切割傳送。
模擬之進行。
模擬結果之接收及存檔。
繪出弦波輸入及弦波階響應圖。
